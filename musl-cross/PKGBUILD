# Maintainer: valr <valere dot monseur at ymail dot com>

pkgname=musl-cross-x86_64
pkgver=1.1.2
pkgrel=50
pkgdesc='A musl libc cross-compiler for x86_64'
url='http://musl.codu.org/'
license=('MIT')
arch=('x86_64')
options=('!strip' 'libtool' 'staticlibs' 'emptydirs')
source=('https://e82b27f594c813a5a4ea5b07b06f16c3777c3b8c.googledrive.com/host/0BwnS5DMB0YQ6bDhPZkpOYVFhbk0/musl-1.1.2/crossx86-x86_64-linux-musl-1.1.2.tar.xz')
md5sums=('78c3b364b142356a0a1b49e105c31027')

PKGEXT='.pkg.tar'

build() {
  # the cross-compiler is pre-built
  return 0
}

package() {
  cd "${srcdir}"/x86_64-linux-musl

  PREFIX="/opt/cross/musl/x86_64-linux-musl"

  # install the cross-compiler

  install -d "${pkgdir}"/"${PREFIX}"

  cp -R bin               "${pkgdir}"/"${PREFIX}"
  cp -R include           "${pkgdir}"/"${PREFIX}"
  cp -R lib               "${pkgdir}"/"${PREFIX}"
  cp -R libexec           "${pkgdir}"/"${PREFIX}"
  cp -R x86_64-linux-musl "${pkgdir}"/"${PREFIX}"

  # FIXME: install the kernel headers (linux-api-headers)
  # yes, I know it's ugly and shouldn't be done here anyway

  ln -s /usr/include/asm-generic "${pkgdir}"/"${PREFIX}"/x86_64-linux-musl/include/asm-generic
  ln -s /usr/include/asm         "${pkgdir}"/"${PREFIX}"/x86_64-linux-musl/include/asm
  ln -s /usr/include/linux       "${pkgdir}"/"${PREFIX}"/x86_64-linux-musl/include/linux
  ln -s /usr/include/mtd         "${pkgdir}"/"${PREFIX}"/x86_64-linux-musl/include/mtd
  ln -s /usr/include/rdma        "${pkgdir}"/"${PREFIX}"/x86_64-linux-musl/include/rdma
  ln -s /usr/include/scsi        "${pkgdir}"/"${PREFIX}"/x86_64-linux-musl/include/scsi
  ln -s /usr/include/sound       "${pkgdir}"/"${PREFIX}"/x86_64-linux-musl/include/sound
  ln -s /usr/include/uapi        "${pkgdir}"/"${PREFIX}"/x86_64-linux-musl/include/uapi
  ln -s /usr/include/video       "${pkgdir}"/"${PREFIX}"/x86_64-linux-musl/include/video
  ln -s /usr/include/xen         "${pkgdir}"/"${PREFIX}"/x86_64-linux-musl/include/xen
}
